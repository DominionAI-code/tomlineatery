import{r as n,j as e,D as H,E as J,G as C,I as M,J as P,X as S,S as B,T as G}from"./react-vendor-BFA5zqns.js";import"./vendor-CirrtjDw.js";import"./chart-vendor-D3kDpm5S.js";const X="https://tomlin-backend.onrender.com",K=()=>{const[F,D]=n.useState([]),[N,w]=n.useState(!0),[v,l]=n.useState(null),[f,c]=n.useState(!1),[o,_]=n.useState(null),[y,E]=n.useState("all"),[m,A]=n.useState(""),[a,T]=n.useState({key:"due_date",direction:"asc"}),[d,j]=n.useState({restaurant_name:"",amount_due:"",due_date:"",is_paid:!1}),u=async()=>{try{w(!0);const s=await fetch(`${X}/api/leases/`);if(!s.ok)throw new Error("Failed to fetch payments");const t=await s.json();D(t),l(null)}catch(s){l("Failed to load lease payments. Please try again later."),console.error("Error fetching payments:",s)}finally{w(!1)}};n.useEffect(()=>{u()},[]);const x=s=>{const{name:t,value:r,type:g,checked:I}=s.target;j({...d,[t]:g==="checkbox"?I:r})},b=()=>{j({restaurant_name:"",amount_due:"",due_date:"",is_paid:!1}),_(null)},L=s=>{j({restaurant_name:s.restaurant_name,amount_due:s.amount_due,due_date:s.due_date,is_paid:s.is_paid}),_(s.id),c(!0)},z=async s=>{s.preventDefault();try{let t="https://tomlin-backend.onrender.com/api/api/leases/",r="POST";if(o&&(t=`https://tomlin-backend.onrender.com/api/api/leases/${o}/`,r="PUT"),!(await fetch(t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).ok)throw new Error(`Failed to ${o?"update":"create"} payment`);u(),b(),c(!1)}catch(t){l(`Failed to save payment: ${t.message}`),console.error("Error saving payment:",t)}},$=async s=>{if(window.confirm("Are you sure you want to delete this payment?"))try{if(!(await fetch(`https://tomlin-backend.onrender.com/api/api/leases/${s}/`,{method:"DELETE"})).ok)throw new Error("Failed to delete payment");u()}catch(t){l("Failed to delete payment"),console.error("Error deleting payment:",t)}},U=async s=>{try{if(!(await fetch(`https://tomlin-backend.onrender.com/api/api/leases/${s.id}/`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_paid:!s.is_paid})})).ok)throw new Error("Failed to update payment status");u()}catch(t){l("Failed to update payment status"),console.error("Error updating payment status:",t)}},h=s=>{let t="asc";a.key===s&&a.direction==="asc"&&(t="desc"),T({key:s,direction:t})},O=()=>{let s=[...F];return m&&(s=s.filter(t=>t.restaurant_name.toLowerCase().includes(m.toLowerCase()))),y==="paid"?s=s.filter(t=>t.is_paid):y==="unpaid"&&(s=s.filter(t=>!t.is_paid)),s.sort((t,r)=>t[a.key]<r[a.key]?a.direction==="asc"?-1:1:t[a.key]>r[a.key]?a.direction==="asc"?1:-1:0),s},p=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),q=s=>{const t={year:"numeric",month:"short",day:"numeric"};return new Date(s).toLocaleDateString(void 0,t)},k=s=>{if(s.is_paid)return!1;const t=new Date;return t.setHours(0,0,0,0),new Date(s.due_date)<t},R=s=>{const t=new Date;t.setHours(0,0,0,0);const r=new Date(s),g=t-r;return Math.ceil(g/(1e3*60*60*24))},i=O();return e.jsx("div",{className:"min-h-screen bg-gray-50 h-screen max-h-screen overflow-y-auto",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lease Payment Tracker"}),e.jsxs("button",{onClick:()=>{b(),c(!f)},className:"flex items-center bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors duration-300",children:[e.jsx(H,{size:18,className:"mr-1"}),f?"Cancel":"Add Payment"]})]}),v&&e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded",children:e.jsx("p",{children:v})}),f&&e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:o?"Edit Payment":"Add New Payment"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"restaurant_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Restaurant Name"}),e.jsx("input",{type:"text",id:"restaurant_name",name:"restaurant_name",value:d.restaurant_name,onChange:x,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount_due",className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount Due ($)"}),e.jsx("input",{type:"number",id:"amount_due",name:"amount_due",value:d.amount_due,onChange:x,required:!0,step:"0.01",min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"due_date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",id:"due_date",name:"due_date",value:d.due_date,onChange:x,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_paid",name:"is_paid",checked:d.is_paid,onChange:x,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_paid",className:"ml-2 block text-sm text-gray-700",children:"Payment Received"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{b(),c(!1)},className:"mr-3 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:o?"Update Payment":"Add Payment"})]})]})]}),e.jsx("div",{className:"bg-white shadow-md rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("label",{htmlFor:"filter",className:"mr-2 text-sm font-medium text-gray-700",children:[e.jsx(J,{size:18,className:"inline mr-1"}),"Filter:"]}),e.jsxs("select",{id:"filter",value:y,onChange:s=>E(s.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Payments"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"unpaid",children:"Unpaid"})]})]}),e.jsx("div",{className:"flex-1 md:max-w-xs",children:e.jsx("input",{type:"text",placeholder:"Search by restaurant name...",value:m,onChange:s=>A(s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})})]})}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:N?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-3 text-gray-600",children:"Loading payments..."})]}):i.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-gray-500",children:["No payments found. ",m&&"Try adjusting your search."]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsxs("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("restaurant_name"),children:["Restaurant Name",a.key==="restaurant_name"&&e.jsx("span",{className:"ml-1",children:a.direction==="asc"?"↑":"↓"})]}),e.jsxs("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("amount_due"),children:["Amount Due",a.key==="amount_due"&&e.jsx("span",{className:"ml-1",children:a.direction==="asc"?"↑":"↓"})]}),e.jsxs("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("due_date"),children:["Due Date",a.key==="due_date"&&e.jsx("span",{className:"ml-1",children:a.direction==="asc"?"↑":"↓"})]}),e.jsxs("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("is_paid"),children:["Status",a.key==="is_paid"&&e.jsx("span",{className:"ml-1",children:a.direction==="asc"?"↑":"↓"})]}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(s=>e.jsxs("tr",{className:k(s)?"bg-red-50":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.restaurant_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(C,{size:16,className:"mr-1 text-gray-400"}),p(s.amount_due)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(M,{size:16,className:"mr-1 text-gray-400"}),q(s.due_date),k(s)&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[R(s.due_date)," days overdue"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>U(s),className:`inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded ${s.is_paid?"bg-green-100 text-green-800 hover:bg-green-200":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"}`,children:s.is_paid?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:14,className:"mr-1"}),"Paid"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:14,className:"mr-1"}),"Unpaid"]})})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>L(s),className:"text-blue-600 hover:text-blue-900 mr-3",children:e.jsx(B,{size:18})}),e.jsx("button",{onClick:()=>$(s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(G,{size:18})})]})]},s.id))})]})})}),!N&&i.length>0&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-5 sm:grid-cols-3",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow-md rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500 rounded-md p-3",children:e.jsx(C,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Amount Due"}),e.jsx("dd",{className:"text-lg font-semibold text-gray-900",children:p(i.reduce((s,t)=>s+parseFloat(t.amount_due),0))})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-md rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-green-500 rounded-md p-3",children:e.jsx(P,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Paid Amount"}),e.jsx("dd",{className:"text-lg font-semibold text-gray-900",children:p(i.filter(s=>s.is_paid).reduce((s,t)=>s+parseFloat(t.amount_due),0))})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-md rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-yellow-500 rounded-md p-3",children:e.jsx(S,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Outstanding Amount"}),e.jsx("dd",{className:"text-lg font-semibold text-gray-900",children:p(i.filter(s=>!s.is_paid).reduce((s,t)=>s+parseFloat(t.amount_due),0))})]})})]})})})]})]})})},Y=()=>e.jsx("div",{className:"flex h-screen",children:e.jsx("div",{className:"flex flex-col flex-1",children:e.jsxs("div",{className:"p-6 bg-gray-100",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Lease Management"})}),e.jsx(K,{})]})})});export{Y as default};
//# sourceMappingURL=LeasesPage-PYGCVumq.js.map
